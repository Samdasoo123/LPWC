<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì—°ì•  ì‹¬ë¦¬ ì›”ë“œì»µ Â· 16ê°•(ì˜ìƒ)</title>

  <!-- í”„ë¦¬ë¡œë“œ(ì„ íƒ) -->
  <link rel="preload" as="image" href="./assets/bg/bg_4k.jpg">
  <link rel="preload" as="image" href="./assets/logo/logo_main_kr.png">
  <link rel="preload" as="audio" href="./assets/audio/bgm_game.wav">
  <link rel="preload" as="video" href="./assets/video/S1.mp4">
  <link rel="preload" as="image" href="./assets/video/poster/S1.jpg">

  <style>
    :root{
      --bg:#fff0f6; --ink:#19202a; --muted:#7891a6;
      --glass:rgba(255,255,255,.65); --line:rgba(255,182,193,.55);
      --shadow:0 12px 40px rgba(246,86,146,.08), 0 4px 14px rgba(17,12,46,.08);
      --bar-grad:linear-gradient(90deg,#ff9ad0,#ffd2a4,#8ef0d0,#b7a9ff);
      --bar-stripe:repeating-linear-gradient(45deg, rgba(255,255,255,.45) 0 10px, rgba(255,255,255,0) 10px 20px);
      --accent:#ff5fa6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,'Noto Sans KR',sans-serif;
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(255,213,230,.65), transparent),
        radial-gradient(1000px 500px at 120% 0%, rgba(255,240,200,.50), transparent),
        url('./assets/bg/bg_4k.jpg') center/cover fixed no-repeat;
      position:relative;
    }
    body::before{
      content:""; position:fixed; inset:0; pointer-events:none;
      background:
        radial-gradient(60% 60% at 50% 55%, rgba(255,255,255,.10), rgba(0,0,0,.35)),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.2));
    }

    /* í—¤ë” */
    header{
      position:sticky; top:0; z-index:10; padding:6px 16px;
      border-bottom:1px solid var(--line);
      display:flex;justify-content:space-between;align-items:center;
      backdrop-filter:saturate(120%) blur(10px);
      background:linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.25));
      box-shadow:0 2px 10px rgba(255,133,192,.12);
    }
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none}
    .brand img{height:40px; width:auto; display:block; filter: drop-shadow(0 2px 6px rgba(255,105,180,.35));}
    @media (max-width:480px){ .brand img{height:32px} header{padding:4px 12px} }

    .wrap{max-width:1200px;margin:0 auto;padding:24px 20px}

    .btn{
      appearance:none;border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      color:var(--ink); font-weight:800; letter-spacing:.01em;
      padding:12px 18px; border-radius:14px; cursor:pointer;
      box-shadow: var(--shadow);
      transition: transform .08s ease, box-shadow .15s, border-color .15s, background .15s;
    }
    .btn:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 28px rgba(255,133,192,.25), 0 2px 10px rgba(17,12,46,.08) inset;
      border-color:rgba(255,133,192,.75);
    }

    .muted{color:var(--muted)} .small{font-size:12px}

    /* ì•„ë ˆë‚˜ ì¹´ë“œ */
    .arena{
      background:var(--glass);
      border:1px solid var(--line);
      border-radius:24px;
      padding:16px;
      backdrop-filter: blur(14px) saturate(130%);
      box-shadow: var(--shadow);
    }

    /* ì§„í–‰ë°” */
    .barwrap{
      position:relative; height:22px; border-radius:999px; overflow:hidden;
      margin:10px 0 16px; background:rgba(255,255,255,.65);
      border:1px solid rgba(255,133,192,.60); box-shadow: inset 0 1px 2px rgba(0,0,0,.06);
    }
    .bar{position:absolute; left:0; top:0; height:100%; width:0%; background:var(--bar-grad); transition:width .25s ease;}
    .bar::after{content:""; position:absolute; inset:0; background:var(--bar-stripe); mix-blend-mode:soft-light; animation:shine 8s linear infinite;}
    .bartext{position:absolute; left:50%; top:50%; transform:translate(-50%,-52%); font-size:12px; font-weight:900; color:#ff3a91; text-shadow:0 1px 3px rgba(255,255,255,.9); pointer-events:none;}
    @keyframes shine{0%{background-position:0 0}100%{background-position:300px 0}}

    /* VS ì¹´ë“œ (ì„¸ë¡œ 9:16) */
    .pair{ display:grid; gap:18px; align-items:center; grid-template-columns:1fr; }
    @media (min-width:900px){ .pair{ grid-template-columns:repeat(2, minmax(0, 560px)); justify-content:center; } }

    .candidate{
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      border:1px solid var(--line); border-radius:24px; overflow:hidden; padding:0;
      cursor:pointer; display:flex; flex-direction:column;
      transition:transform .08s ease, box-shadow .15s, border-color .15s; box-shadow: var(--shadow);
    }
    .candidate:hover{ transform:translateY(-3px); border-color:rgba(255,133,192,.9); box-shadow:0 20px 42px rgba(255,133,192,.28); }
    .candidate:active{ transform:translateY(0) scale(.995); }
    .candidate.pop{ animation:pop .18s ease }
    @keyframes pop{ 0%{transform:scale(1)} 60%{transform:scale(1.02)} 100%{transform:scale(1)} }

    .mediaV{ position:relative; width:100%; aspect-ratio:9/16; height:auto; max-height:78vh; border-radius:inherit; overflow:hidden; background:#fff1f7; }
    .mediaV>*{ width:100%; height:100%; object-fit:cover; object-position:center top; display:block; }

    /* Spotlight/Result ê³µí†µ ë¯¸ë””ì–´(ê°€ë¡œ 16:9 + ì˜¤ë²„ë ˆì´) */
    .mediaH{
      position:relative;
      max-width:min(60vw, 820px); width:100%; height:auto; aspect-ratio:16/9;
      border-radius:20px; overflow:hidden; border:1px solid var(--line); background:#fff1f7;
      box-shadow:0 10px 30px rgba(0,0,0,.12);
    }
    .mediaH::after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.15));
      pointer-events:none;
    }
    .mediaH>*{ width:100%; height:100%; object-fit:cover; object-position:center; display:block; }

    .label{ padding:12px 16px;display:flex;justify-content:space-between;gap:8px;align-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.8)); border-top:1px solid var(--line); }
    .name{font-weight:900; color:var(--accent); letter-spacing:.01em}
    .seed{font-size:12px;color:var(--muted)}

    .tag{ display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line); background:rgba(255,255,255,.92);
      border-radius:999px; padding:5px 12px; font-size:12px; color:var(--accent); box-shadow: var(--shadow); font-weight:800; }

    main>section{display:none !important}
    body[data-view="game"]   #screen-game{display:block !important}
    body[data-view="spot"]   #screen-spot{display:block !important}
    body[data-view="result"] #screen-result{display:block !important}

    /* ===== ê²°ê³¼ í™”ë©´ ê°•í™” ===== */
    .panel{ background:var(--glass); border:1px solid var(--line); border-radius:24px; padding:20px; backdrop-filter: blur(14px) saturate(130%); box-shadow: var(--shadow); }
    .panel.result{
      padding:28px 22px;
      background:linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.6));
      border:1px solid rgba(255,133,192,.45);
    }
    .title{
      margin:12px 0 8px; font-size:28px; line-height:1.25; font-weight:900; letter-spacing:.01em;
      text-align:center; color:#101621; text-shadow:0 1px 0 rgba(255,255,255,.7), 0 12px 30px rgba(0,0,0,.08);
    }
    @media (max-width:560px){ .title{font-size:22px} }
    .desc{max-width:760px; text-align:center; margin:6px auto 8px; color:#415163; font-weight:600}
    .chips{display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin:6px 0 2px}

    .kpis{display:grid; gap:10px; max-width:560px; width:100%; margin:8px auto 14px}
    .krow{display:grid; grid-template-columns:96px 1fr 48px; gap:10px; align-items:center}
    .krow .kname{color:#37485a; font-weight:800; text-align:right}
    .meter{height:12px; background:rgba(0,0,0,.06); border:1px solid rgba(255,133,192,.45); border-radius:999px; overflow:hidden; position:relative}
    .meter .fill{height:100%; width:0%; background:var(--bar-grad); transition:width .7s ease}
    .kval{font-weight:900; color:#0f1a26; text-align:left}

    .actions{display:flex; gap:10px; justify-content:center; margin-top:6px; flex-wrap:wrap}
    .btn.primary{background:linear-gradient(180deg,#ffe1f0,#ffd4ea); border-color:rgba(255,133,192,.7); color:#101621}

    /* í•˜íŠ¸ */
    .heart{ position:fixed; pointer-events:none; z-index:9999; font-size:16px; animation: float 900ms ease forwards; filter: drop-shadow(0 4px 8px rgba(255,105,180,.35)); }
    @keyframes float{ 0%{ transform:translate(-50%,-30%) scale(.8); opacity:.9 } 70%{ opacity:1 } 100%{ transform:translate(-50%,-120%) scale(1.2); opacity:0 } }
  </style>
</head>
<body data-view="game">
  <header>
    <!-- í™ˆ ì´ë™ì€ í•­ìƒ ìƒëŒ€ê²½ë¡œ ./ ë¡œ (index.html) -->
    <a class="brand" href="./" aria-label="ì—°ì•  ì‹¬ë¦¬ ì›”ë“œì»µ í™ˆìœ¼ë¡œ">
      <img src="./assets/logo/logo_main_kr.png" alt="ì—°ì•  ì‹¬ë¦¬ ì›”ë“œì»µ ë¡œê³ (ì‘ê²Œ)">
    </a>
    <div>
      <button class="btn" id="btnHome">íƒ€ì´í‹€ë¡œ</button>
    </div>
  </header>

  <main class="wrap">
    <!-- Game -->
    <section id="screen-game">
      <div class="arena">
        <span class="tag" id="roundTag">ğŸ’˜ 16ê°• ì‹œì‘</span>
        <div class="barwrap" aria-live="polite">
          <div id="bar" class="bar"></div>
          <div id="bartext" class="bartext">0 / 15</div>
        </div>
        <div id="pair" class="pair"></div>
      </div>
    </section>

    <!-- Spotlight -->
    <section id="screen-spot">
      <div class="panel center">
        <div class="tag">ğŸ† ìµœì¢… ìš°ìŠ¹</div>
        <h2 class="title">ìš°ìŠ¹ìë¥¼ ì†Œê°œí•©ë‹ˆë‹¤! <span id="count" class="small muted"></span></h2>
        <div id="spotMedia" class="mediaH"></div>
        <div class="small muted" style="margin-top:6px">ê³§ ê²°ê³¼ í•´ì„ì´ í‘œì‹œë©ë‹ˆë‹¤â€¦</div>
      </div>
    </section>

    <!-- Result -->
    <section id="screen-result">
      <div class="panel result center">
        <div class="tag">ğŸ“œ ê²°ê³¼</div>
        <div id="winnerMedia" class="mediaH" style="max-width:min(70vw,900px)"></div>

        <h2 id="profileTitle" class="title">ë‹¹ì‹ ì˜ ì—°ì•  ì‹¬ë¦¬</h2>
        <p id="profileDesc" class="desc">ì§§ì€ ì„¤ëª…â€¦</p>

        <div id="profileTags" class="chips"></div>
        <div id="axisBars" class="kpis"></div>

        <div class="actions">
          <button class="btn primary" id="btnAgain">ë‹¤ì‹œ í•˜ê¸°</button>
          <button class="btn" id="btnShare">ê²°ê³¼ ê³µìœ </button>
        </div>
      </div>
    </section>
  </main>

  <script>
    /* ===== ë°°ê²½ìŒ ===== */
    const GAME_BGM = new Audio('./assets/audio/bgm_game.wav');
    GAME_BGM.loop = true; GAME_BGM.volume = 0;
    let gameBgmStarted = false;
    function fadeTo(target=0.45, ms=1200){
      const steps=20, step=(target-GAME_BGM.volume)/steps, dt=Math.max(16, ms/steps);
      let i=0; const iv=setInterval(()=>{ i++; GAME_BGM.volume=Math.max(0,Math.min(1,GAME_BGM.volume+step)); if(i>=steps) clearInterval(iv)}, dt);
    }
    function startGameBGM(){ if(gameBgmStarted) return; gameBgmStarted=true; GAME_BGM.play().then(()=>fadeTo()).catch(()=>{}); }
    document.addEventListener('DOMContentLoaded', ()=>{
      GAME_BGM.play().then(()=>fadeTo()).catch(()=>['click','touchstart','keydown'].forEach(e=>addEventListener(e,startGameBGM,{once:true,passive:true})));
    });
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden && gameBgmStarted && GAME_BGM.paused) GAME_BGM.play().catch(()=>{}); });

    /* ===== ì¹´ë“œ ë°ì´í„° (mediaë§Œ ì‚¬ìš©) ===== */
    const RAW_CARDS = [
      {id:'S1', title:'ì†”ì§ ì§ì„¤ í™”ë²•',    tags:['ì§ì ‘'],             media:'./assets/video/S1.mp4'},
      {id:'S2', title:'ê°œì¸ì‹œê°„ ì¤‘ìš”',      tags:['ë¶„ë¦¬'],             media:'./assets/video/S2.mp4'},
      {id:'S3', title:'ì¦‰ì„ ë°”ë‹¤ ë“œë¼ì´ë¸Œ', tags:['ìê·¹','ì¦‰í¥'],      media:'./assets/video/S3.mp4'},
      {id:'S4', title:'í•˜ë£¨ í•œ í†µ í•„ìˆ˜',    tags:['í•¨ê»˜','ë§ë¡œ'],      media:'./assets/video/S4.mp4'},
      {id:'S5', title:'ì´ë²¤íŠ¸ëŠ” í¬ê²Œ!',     tags:['í–‰ë™','ì•ˆì •'],      media:'./assets/video/S5.mp4'},
      {id:'S6', title:'ì—°ë½ ì¦ê²Œ',          tags:['í•¨ê»˜','ì§ì ‘'],      media:'./assets/video/S6.mp4'},
      {id:'S7', title:'íƒ€í˜‘ì•ˆ ë¨¼ì € ì œì‹œ',   tags:['ë¬¸ì œí•´ê²°'],         media:'./assets/video/S7.mp4'},
      {id:'S8', title:'ì‹ ìƒ ë¯¸ì‹ íƒë°©',     tags:['ìê·¹'],             media:'./assets/video/S8.mp4'},

      {id:'C1', title:'ì•½ì† ì² ì € í”Œë˜ë„ˆ',     tags:['ì•ˆì •','ê³„íš'],      media:'./assets/video/C1.mp4'},
      {id:'C2', title:'ì¦‰í¥ ì—ë„ˆì§€ ë¿œë¿œ',     tags:['ìê·¹','ì¦‰í¥'],      media:'./assets/video/C2.mp4'},
      {id:'C3', title:'ì†”ë£¨ì…˜ ì œì‹œí˜•',        tags:['ë¬¸ì œí•´ê²°','ì§ì ‘'],  media:'./assets/video/C3.mp4'},
      {id:'C4', title:'ë¶„ìœ„ê¸° ë°°ë ¤íŒŒ',        tags:['ë°°ë ¤','í•¨ê»˜'],      media:'./assets/video/C4.mp4'},
      {id:'C5', title:'ê°œì¸ì‹œê°„ ì¤‘ìš”',        tags:['ë¶„ë¦¬'],             media:'./assets/video/C5.mp4'},
      {id:'C6', title:'í–‰ë™ìœ¼ë¡œ ë³´ì—¬ì¤Œ',      tags:['í–‰ë™'],             media:'./assets/video/C6.mp4'},
      {id:'C7', title:'ë§ë¡œ í™•ì¸ë°›ê³  ì‹¶ìŒ',   tags:['ë§ë¡œ'],             media:'./assets/video/C7.mp4'},
      {id:'C8', title:'ì†”ë£¨ì…˜ ì œì‹œí˜•',        tags:['ë¬¸ì œí•´ê²°','ì§ì ‘'],  media:'./assets/video/C8.mp4'},
    ];

    // í¬ìŠ¤í„° ìë™ ìœ ì¶”: /video/xxx.mp4 â†’ /video/poster/xxx.jpg
    const POSTER_FALLBACK = './assets/bg/bg_4k.jpg';
    const CARDS_16 = RAW_CARDS.map(c=>{
      const poster = c.media.replace(/\/video\/(.+?)\.mp4$/i, '/video/poster/$1.jpg');
      return {...c, poster};
    });

    /* ===== ìœ í‹¸/ìƒíƒœ ===== */
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const shuffle = a => { for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; };

    let bracket=[], queue=[], next=[], history=[], played=0, winner=null, picking=false;
    const totalMatches = CARDS_16.length - 1; // 16ê°• ì „ì²´ ë§¤ì¹˜ìˆ˜ = 15
    const setView = v => document.body.setAttribute('data-view', v);

    function hearts(x,y,count=6){
      for(let i=0;i<count;i++){
        const el=document.createElement('div');
        el.className='heart';
        el.textContent=['ğŸ’–','ğŸ’—','ğŸ’','ğŸ’“'][i%4];
        el.style.left=(x+(Math.random()*36-18))+'px';
        el.style.top=(y+(Math.random()*16-8))+'px';
        el.style.fontSize=(14+Math.random()*8)+'px';
        document.body.appendChild(el);
        setTimeout(()=>el.remove(),900);
      }
    }

    function roundName(n){ return n>=16?'16ê°•':n>=8?'8ê°•':n>=4?'4ê°•':n===2?'ê²°ìŠ¹':''; }
    function updateRoundTag(){
      const name = roundName(bracket.length);
      const suffix = queue.length===Math.ceil(bracket.length/2) ? ' ì‹œì‘' : ' ì§„í–‰';
      $('#roundTag').textContent = `ğŸ’˜ ${name}${suffix}`;
    }

    function updateProgress(){
      const pct = Math.min(100, Math.round((played/totalMatches)*100));
      $('#bar').style.width = pct + '%';
      $('#bartext').textContent = `${played} / ${totalMatches}`;
    }

    function mediaTag(src, poster){
      return `<video src="${src}" poster="${poster}" autoplay muted loop playsinline preload="metadata"
                disablepictureinpicture controlslist="nodownload noplaybackrate noremoteplayback nofullscreen"></video>`;
    }

    const seedPairs = arr => { const s=shuffle([...arr]); const pairs=[]; for(let i=0;i<s.length;i+=2){ pairs.push([s[i], s[i+1]]);} return pairs; };

    function start(){
      bracket = shuffle([...CARDS_16]);
      queue = seedPairs(bracket);
      next = []; history=[]; played=0; winner=null; picking=false;
      setView('game'); updateRoundTag(); updateProgress(); renderPair();
    }

    function renderPair(){
      const root = $('#pair'); root.innerHTML='';
      if(queue.length===0){
        if(next.length===1){ winner=next[0]; return spotlight(); }
        bracket = next; next=[]; queue = seedPairs(bracket);
        updateRoundTag(); return renderPair();
      }
      const [a,b]=queue[0];
      const make = (card,side)=>{
        const btn=document.createElement('button'); btn.className='candidate';
        const poster = card.poster || POSTER_FALLBACK;
        btn.innerHTML = `
          <div class="mediaV">
            ${mediaTag(card.media, poster)}
          </div>
          <div class="label">
            <span class="name">${card.title}</span>
            <span class="seed">${side==='L'?'â† [A]':'â†’ [D]'}</span>
          </div>`;
        btn.addEventListener('click',e=>pick(card,a,b,e));
        return btn;
      };
      root.appendChild(make(a,'L')); root.appendChild(make(b,'R'));
    }

    function pick(chosen,left,right,evt){
      if(picking) return; picking=true;
      const card = evt?.currentTarget; card?.classList.add('pop');
      const r = card?.getBoundingClientRect?.();
      hearts((r?.left||evt.clientX)+r.width/2, (r?.top||evt.clientY)+r.height/2-20, 8);
      setTimeout(()=>card?.classList.remove('pop'),220);

      next.push(chosen); queue.shift(); played++;
      updateProgress();
      history.push({left:left.id,right:right.id,pick:chosen.id,round:bracket.length});
      renderPair(); setTimeout(()=>picking=false,90);
    }

    function calcProfile(){
      const AXES = ['ì•ˆì •','ìê·¹','ì§ì ‘','ë°°ë ¤','ê³„íš','ì¦‰í¥','ë¶„ë¦¬','í•¨ê»˜','ë¬¸ì œí•´ê²°','ì¿¨ë‹¤ìš´','ë§ë¡œ','í–‰ë™'];
      const score = Object.fromEntries(AXES.map(a=>[a,0]));
      winner.tags?.forEach(t=> score[t]=(score[t]||0)+3);
      const tail=history.slice(-3);
      for(const m of tail){
        const opp=[m.left,m.right].find(id=>id!==m.pick);
        const oppCard=CARDS_16.find(c=>c.id===opp);
        oppCard?.tags?.forEach(t=> score[t]+= (m.round===2?1:0.5));
      }
      return Object.entries(score).sort((a,b)=>b[1]-a[1]).slice(0,3);
    }

    function spotlight(){
      $('#pair').innerHTML='';
      $('#bar').style.width='100%';
      $('#bartext').textContent=`${totalMatches} / ${totalMatches}`;
      $('#roundTag').textContent='ğŸ† ìš°ìŠ¹ í™•ì •';

      const poster = winner.poster || POSTER_FALLBACK;
      $('#spotMedia').innerHTML = `<video src="${winner.media}" poster="${poster}" autoplay muted loop playsinline preload="metadata"></video>`;

      setView('spot'); countdown(3, showResult);
    }

    function profileText(top3){
      const keys = top3.map(([k])=>k);
      const name = (keys.includes('ì•ˆì •')&&keys.includes('ê³„íš'))?'ë¯¿ìŒì§ í”Œë˜ë„ˆ'
                 : (keys.includes('ìê·¹')&&keys.includes('ì¦‰í¥'))?'ìŠ¤íŒŒí´ëŸ¬'
                 : (keys.includes('ì§ì ‘')&&keys.includes('ë¬¸ì œí•´ê²°'))?'ì†”ë£¨ì…˜ ë“œë¦¬ë¸”ëŸ¬'
                 : 'ë§ˆì´ í˜ì´ìŠ¤ ëŸ¬ë²„';
      const desc = {
        'ë¯¿ìŒì§ í”Œë˜ë„ˆ':'ì•½ì†ê³¼ ë£¨í‹´ì´ í¸ì•ˆí•¨ì„ ì¤˜ìš”. ê³„íš ê³µìœ í•˜ë©´ ì• ì •ë„â†‘',
        'ìŠ¤íŒŒí´ëŸ¬':'ìƒˆë¡œì›€ì— ë°˜ì§! ì¦‰ì„ ì œì•ˆ, ì‘ì€ ëª¨í—˜ì— ì„¤ë ˜ì„ ëŠê»´ìš”.',
        'ì†”ë£¨ì…˜ ë“œë¦¬ë¸”ëŸ¬':'ëŒë ¤ ë§í•˜ëŠ” ê²ƒë³´ë‹¤ ë°”ë¡œ í•´ê²°! ìƒí™©ì„ ë‘ê³  ëŒ€í™”í•˜ëŠ” í¸.',
        'ë§ˆì´ í˜ì´ìŠ¤ ëŸ¬ë²„':'ë¬´ë¦¬í•˜ì§€ ì•Šê³  ë‚´ í…œí¬ë¡œ. ì˜¤ë˜ í¸ì•ˆí•œ ê´€ê³„ë¥¼ ì¶”êµ¬í•´ìš”.'
      }[name];
      return {name, desc};
    }

    function showResult(){
      const top3=calcProfile(); const {name,desc}=profileText(top3);
      const poster = winner.poster || POSTER_FALLBACK;
      $('#winnerMedia').innerHTML = `<video src="${winner.media}" poster="${poster}" autoplay muted loop playsinline preload="metadata"></video>`;
      $('#profileTitle').textContent=`ë‹¹ì‹ ì€ Â«${name}Â» íƒ€ì…`;
      $('#profileDesc').textContent=desc;

      // íƒœê·¸ ì¹©
      $('#profileTags').innerHTML=(winner.tags||[]).map(t=>`<span class="tag">#${t}</span>`).join('');

      // KPI ë°”(í¼ì„¼íŠ¸ + ì• ë‹ˆë©”ì´ì…˜)
      const rows = top3.map(([k,v])=>{
        const pct = Math.min(100, Math.round((v/4.5)*100));
        return `
          <div class="krow">
            <div class="kname">${k}</div>
            <div class="meter"><div class="fill" style="width:0%" data-target="${pct}"></div></div>
            <div class="kval">0%</div>
          </div>`;
      }).join('');
      $('#axisBars').innerHTML = rows;

      // ì• ë‹ˆë©”ì´ì…˜
      $$('#axisBars .krow').forEach(row=>{
        const fill=row.querySelector('.fill'); const to=+fill.dataset.target;
        const val=row.querySelector('.kval'); const start=performance.now(); const dur=750;
        function step(t){
          const p=Math.min(1,(t-start)/dur); const v=Math.round(to*p);
          fill.style.width = v+'%'; val.textContent=v+'%';
          if(p<1) requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
      });

      setView('result');
    }

    function countdown(sec,done){
      const el=$('#count'); let t=sec; el.textContent=`(${t}s)`;
      const iv=setInterval(()=>{ t--; el.textContent=`(${t}s)`; if(t<=0){clearInterval(iv); el.textContent=''; done();}},1000);
    }

    /* ì´ë²¤íŠ¸ */
    function shareNow(){
      const url=new URL(location.href); if(winner) url.searchParams.set('winner', winner.id);
      const shareUrl=url.toString();
      (async ()=>{
        try{
          if(navigator.share){ await navigator.share({title:'ì—°ì•  ì‹¬ë¦¬ ì›”ë“œì»µ', url:shareUrl}); }
          else { await navigator.clipboard.writeText(shareUrl); alert('ë§í¬ ë³µì‚¬ ì™„ë£Œ'); }
        }catch(e){ prompt('ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”', shareUrl); }
      })();
    }

    // âœ… í™ˆ ì´ë™ì€ í•­ìƒ ./ ë¡œ (index.html)
    document.getElementById('btnHome').addEventListener('click', ()=> location.assign('./'));
    document.getElementById('btnAgain').addEventListener('click', start);
    document.getElementById('btnShare').addEventListener('click', shareNow);

    window.addEventListener('keydown', (e)=>{
      if(document.body.getAttribute('data-view')!=='game') return;
      const [L,R] = $$('#pair .candidate'); if(!L||!R) return;
      if(['ArrowLeft','a','A','Enter'].includes(e.key)) L.click();
      if(['ArrowRight','d','D'].includes(e.key)) R.click();
    });

    document.addEventListener('DOMContentLoaded', start);
  </script>
</body>
</html>
